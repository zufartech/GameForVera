<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Rocks & Diamonds</title>
</head>
<body>
    <div class="container">
        <div div class="numsL">
            <button class="remark"  value='on'  id="r0" >0</button>
            <button class="remark"  value='on'  id="r1" >1</button>
            <button class="remark"  value='on'  id="r2" >2</button>
            <button class="remark"  value='on'  id="r3" >3</button>
            <button class="remark"  value='on'  id="r4" >4</button>
            <button class="remark"  value='on'  id="r5" >5</button>
            <button class="remark"  value='on'  id="r6" >6</button>
            <button class="remark"  value='on'  id="r7" >7</button>
            <button class="remark"  value='on'  id="r8" >8</button>
            <button class="remark"  value='on'  id="r9" >9</button>
            <button class="menu"                id="play">play</button>
            <button class="menu"                id="show">show</button>
            <button class="menu"                id="dig" >- 5 -</button>
        </div>
        <div id="playground">
             <textarea id="textbox" cols=22 rows=28 disabled >  Train your brain</textarea>
        </div>
        <div class="nums">
            <button class="dial"    value='on'  id="d0"   >0</button>
            <button class="dial"    value='on'  id="d1"   >1</button>
            <button class="dial"    value='on'  id="d2"   >2</button>
            <button class="dial"    value='on'  id="d3"   >3</button>
            <button class="dial"    value='on'  id="d4"   >4</button>
            <button class="dial"    value='on'  id="d5"   >5</button>
            <button class="dial"    value='on'  id="d6"   >6</button>
            <button class="dial"    value='on'  id="d7"   >7</button>
            <button class="dial"    value='on'  id="d8"   >8</button>
            <button class="dial"    value='on'  id="d9"   >9</button>
            <button class="menu"                id="enterb">enter</button>
            <button class="menu"                id="cancel">cancel</button>
            <button class="menu"                id="about">about</button>

        </div>
    </div>
    <!-- <script async src="rocks-diamonds.js" type="module"> </script>
    <script src="defense-alg.js" type="module"></script> -->
    <!-- <script src="zufar.js"></script> -->
    <script>
        let gameStatus = false;
        let digits = 5;
        let lastStateButton = 5;
        let target=[];
        let column = -2;
        let symbol = 0;


//******************************* abot ***********************************************************
let abouText = "Train your brain by Zufar and Raduan for dear Vera üôè";
about.onclick = function() {
     alert(abouText)
     // document.getElementById('textbox').textContent = abouText
}

// ****************************** init ***********************************************************
function init(){
    //  gameStatus = false;
    // alert('hello init')
    column = -2;
    symbol = 0;
    target.length = 0; //zeroing the entire array
     document.getElementById('textbox').textContent = '-- ';
     for (let i = 0; i < 10; i++){
        //**************************** remark default set *********
        buttonRemark[i].style.backgroundColor = 'rgb(80,80,80)';
        buttonRemark[i].value ='on';
        buttonRemark[i].style.color = 'rgb(238, 238, 238)';
        //**************************** dial default set ***********
        buttonDial[i].style.backgroundColor = 'rgb(80,80,80)';
        buttonDial[i].value ='on';
        buttonDial[i].style.color = 'rgb(238, 238, 238)';
        buttonDial[i].addEventListener('click', buttonDialHandler);
     }
}

//******************************* remarkButtons ****************************************************
let buttonRemark = document.querySelectorAll('.remark'); // get'remark' buttons to array
buttonRemark.forEach(btnR => {
    btnR.addEventListener('click', buttonRemarkHandler)
})


function buttonRemarkHandler(e){
    // alert(e.target.value);
    if(gameStatus){
        if(e.target.value =='on'){
            //remrk-----------------------------------------
            e.target.style.backgroundColor = 'rgb(48,48,48)';
            e.target.style.color = 'rgb(96, 96, 96)';
            e.target.value = 'off';
            //dial------------------------------------------
            document.getElementById(`d${e.target.textContent}`).removeEventListener('click', buttonDialHandler);
            document.getElementById(`d${e.target.textContent}`).style.backgroundColor = 'rgb(48,48,48)';
            document.getElementById(`d${e.target.textContent}`).style.color = 'rgb(96, 96, 96)';
            document.getElementById(`d${e.target.textContent}`).value = 'off';
        }
        else{
            //remrk-----------------------------------------
            e.target.style.backgroundColor = 'rgb(80,80,80)';
            e.target.style.color = 'rgb(238, 238, 238)';
            e.target.value ='on';
            //dial------------------------------------------
            document.getElementById(`d${e.target.textContent}`).addEventListener('click', buttonDialHandler);
            document.getElementById(`d${e.target.textContent}`).style.backgroundColor = 'rgb(80,80,80)';
            document.getElementById(`d${e.target.textContent}`).style.color = 'rgb(238, 238, 238)';
            document.getElementById(`d${e.target.textContent}`).value = 'on';
        }
    }
    // switch (e.target.textContent){
    //     case '0':
    //         alert('0');
    //         break;
    //     case '1':
    //         alert('1');
    //         break;
    // }
}

// alert(buttonRemark.length);
// alert(buttonRemark[0].textContent);

// for (let i = 0; i < document.querySelectorAll("[class='remark']").length; i++) {

//   alert(buttonRemarki[i]);
// }


//*************************************** play *************************************
play.onclick = playStart;
function playStart(){
    // alert('hello play');
    init();
    digits = lastStateButton;
    gameStatus = true;
    while (target.length != digits) {
        let digit = `${Math.floor(Math.random() * 10)}`
        if (target.includes(digit)) continue;
        target.push(digit);
    }
    // target = ['1', '2', '3', '4', '5'];

}

//*************************************** show *************************************

show.onclick = shower; 
function shower(){
    if(gameStatus){
    gameStatus = false;
    document.getElementById('textbox').textContent += '\n' + '-- ' + target + ' --';
    }
}

// ************************************ "- 5 -" ************************************
dig.onclick = function() {
   if (document.getElementById('dig').textContent === '- 5 -'){
        document.getElementById('dig').textContent = '- 6 -';
        lastStateButton = 6;
   }
   else if (document.getElementById('dig').textContent === '- 6 -'){
        document.getElementById('dig').textContent ='- 4 -';
        lastStateButton = 4;
   }
    else {
        document.getElementById('dig').textContent = '- 5 -';
        lastStateButton = 5;
    }

}

//******************************* dialButtons ****************************************************
let buttonDial = document.querySelectorAll('.dial'); // get'dial' buttons to array
buttonDial.forEach(btnD => {
    btnD.addEventListener('click', buttonDialHandler)
})

function buttonDialHandler(e){
    // alert(e.target.value);
    if((gameStatus) && (e.target.value ==='on') && (symbol < digits)){
        // document.getElementById('textbox').textContent = e.target.textContent;
        let line = document.getElementById('textbox').textContent;

        if(symbol > 0){
            if (line.slice(-symbol).split('').includes(e.target.textContent)){
                // alert('repeat');
                return;
            }
        }
        symbol +=1;
        line += e.target.textContent;
        document.getElementById('textbox').textContent = line;
        // if(e.target.textContent === '0'){
        //     line += '\n' + 'new';
        //     document.getElementById('textbox').textContent = line;
        // }

    }
    // switch (e.target.textContent){
    //     case '0':
    //         alert('0');
    //         break;
    //     case '1':
    //         alert('1');
    //         break;
    // }
}

//*************************************** enter *************************************
enterb.onclick=enter;
function enter(){
    if((gameStatus) && (symbol == digits)){
        // alert('hello enter');
        let cut = document.getElementById('textbox').textContent.slice(-digits).split('');
        // let cut = Array.from(document.getElementById('textbox').textContent.slice(-digits), String);
        let k = 0;
        let a = 0;
        let lineNumber = '--';
        // alert(cut[0]);
        for (let i = 0; i < cut.length; i++){
            if((cut.includes(target[i])) && (cut[i] == target[i])){
                a++;
            }
            else if((cut.includes(target[i])) && (cut[i] != target[i])){
                k++;
            }
        }

        let prob = 0;
        if(digits == 4){
            prob = '  - ';
        }
        else if(digits == 5){
            prob = ' - ';
        }
        else if(digits == 6){
            prob = '- ';
        }
        
        symbol = 0;
        column++;

        if(column > 0){
            if(column < 10){
                lineNumber = ' ' + column;
            }
            else{
                lineNumber = column;
            }            
        }
        // let temp = '\na= ' + a + ', k= ' + k + '\n' + target;
        // document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + lineNumber + ' ';
        if(column > 17){
            gameStatus = false;
            if(a == digits){
                document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + '------you win!-----' + '\n' + '-- ' + target + ' --';
            }
            else{
                document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + '----end the game----' + '\n' + '-- ' + target + ' --';
            }
        }
        else if(column == 1){
            if(a == digits){
                gameStatus = false;
                document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + '------you win!-----' + '\n' + '-- ' + target + ' --';
            }
            else {
                document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + '====================' + '\n' + lineNumber + ' ';
            }
        }
        else{
            if(a == digits){
                gameStatus = false;
                document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + '------you win!-----' + '\n' + target;
            }
            else {
                document.getElementById('textbox').textContent += prob + a + '‚ú¶ : ' + k + '‚óá' + '\n' + lineNumber + ' ';
            }       
        }
     }
}

//*************************************** cancel ************************************
cancel.onclick=canceler;
function canceler(){
    if((gameStatus) && (symbol > 0)){
        document.getElementById('textbox').textContent=document.getElementById('textbox').textContent.slice(0, -1);
        symbol --;
    }
}

    </script>
</body>
</html>
